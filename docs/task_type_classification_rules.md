# 作業タイプ分類ルール - bankincafe請求書システム

**作成日**: 2025年9月6日  
**最終更新**: 2025年9月6日  
**バージョン**: 1.0

---

## 📋 概要

板金業界の実際の作業分類に基づいた、請求書明細項目のtask_type自動判定ルールです。
work-searchページの「T/S」表示（T: individual/fuzzy, S: set）に対応しています。

---

## 🎯 作業タイプ分類

### **1. individual（個別作業）- 「T」表示**

#### **定義**
- 同一作業を複数箇所で実施する場合
- 明確な単一作業で、アクションとターゲットが特定できる場合

#### **判定条件**
1. **左右・前後などの同一作業複数箇所**
   ```
   例: 左右ファーストステップブラケット脱着修正
   例: 左右ドアウェザーストリップゴム取替  
   例: 前後バンパー修理
   ```

2. **数量が2以上の明細項目**
   ```
   例: ホイール塗装（数量: 4）
   例: タイヤ交換（数量: 2）
   ```

3. **単一項目でアクション・ターゲットが明確**
   ```
   例: DPFマフラーセンサーボルト折れ込み修理
   例: 右ドアミラーアーム脱着ボルト取り替え加工
   例: リヤバンパー折損鈑金修理
   ```

#### **キーワードパターン**
- **位置ペア**: `左右`, `前後`, `上下`, `内外`
- **同一作業の複数実施を示す表現**

---

### **2. set（セット作業）- 「S」表示**

#### **定義**
- 異なる複数の作業を組み合わせて実施する場合
- 複合作業として一括で請求される場合

#### **判定条件**
1. **「・」「、」「/」で区切られた複数の異なる作業**
   ```
   例: リヤフラッシャーASSY取替・ブラケット鈑金修理
   例: 左バックミラー・ステイ・モーター取替
   例: ホーン交換・ステイ交換・ブラケット鈑金修理
   ```

2. **明示的なセットワード含有（稀）**
   ```
   例: エンジン修理一式
   例: 内装張替セット
   ```

#### **除外条件**
- 左右・前後などの同一作業は**individual**扱い
- 数量複数は**individual**扱い

---

### **3. fuzzy（非構造化）- 「T」表示**

#### **定義**
- 作業内容が不明確で、アクション・ターゲットが特定できない場合
- 単純な作業だが専門的すぎて自動分類が困難な場合

#### **判定条件**
1. **アクション・ターゲットが抽出できない単一作業**
   ```
   例: 取消
   例: 工場内清掃代行
   例: メイン燃料タンクホース延長サブタンク付替え加工
   ```

2. **専門的すぎる作業**
   ```
   例: タンクバンドマス締め
   例: プラットホームブッシュ張替加工
   ```

---

## 🔧 実装ルール（プログラム用）

### **判定優先順序**
```javascript
function determineTaskType(lineItem, parsedItems) {
    // 1. 明示的なセット作業キーワード
    if (isSetWork(lineItem)) return 'set';
    
    // 2. 左右・前後などの同一作業複数箇所
    if (isSameWorkMultipleLocations(rawLabel)) return 'individual';
    
    // 3. 数量が2以上
    if (quantity > 1) return 'individual';
    
    // 4. 複数項目に分割された場合（異なる作業の組み合わせ）
    if (parsedItems.length > 1) return 'set';
    
    // 5. 単一項目でアクション・ターゲット明確
    if (parsedItems.length === 1 && item.action && item.target) return 'individual';
    
    // 6. デフォルト
    return 'fuzzy';
}
```

### **キーワード定義**

#### **同一作業複数箇所判定**
```javascript
const locationPairs = ['左右', '前後', '上下', '内外'];
```

#### **セット作業キーワード（現在は使用頻度低）**
```javascript
const setKeywords = [
    '一式', 'セット', 'SET', 'set', '複数', 
    '全体', '全面', '４枚', '4枚', '２個', '2個', '複数個'
];
```

---

## 📊 分類結果例（実データ）

### **Individual（17件）**
- `左右ファーストステップブラケット脱着修正` ✅
- `左右当たりゴム取外し加工` ✅
- `DPFマフラーセンサーボルト折れ込み修理` ✅
- `右ドアミラーアーム脱着ボルト取り替え加工` ✅

### **Set（26件）**
- `リヤフラッシャーASSY取替・ブラケット鈑金修理` ✅
- `左バックミラー・ステイ・モーター取替` ✅
- `ホーン交換・ステイ交換・ブラケット鈑金修理` ✅

### **Fuzzy（24件）**
- `取消` ✅
- `工場内清掃代行` ✅
- `メイン燃料タンクホース延長サブタンク付替え加工` ✅

---

## 🔄 変更履歴

### **v1.0 (2025-09-06)**
- 初回ルール策定
- 左右・前後の同一作業を individual に分類
- 複合作業（・区切り）を set に分類
- 板金業界の実際の作業分類に基づく判定ロジック確立

---

## 📝 注意事項

### **今後の修正可能性**
- 新しい作業パターンが発見された場合
- 業界慣行の変更があった場合
- ユーザーフィードバックに基づく調整

### **判定精度**
- 現在の精度: 約90%（手動確認による推定）
- 誤分類は主に専門的な作業名での発生

### **メンテナンス**
- 新しい作業パターン発見時は、このドキュメントを更新
- プログラムロジック変更時は、変更履歴に記録
- 定期的な分類結果レビューを実施

---

**このルールは板金業界の実際の作業分類に基づいており、work-searchページの「T/S」表示の正確性を保証します。**