# invoice-create ç”»é¢é …ç›® â†’ DB ãƒãƒƒãƒ”ãƒ³ã‚°ç¢ºèª

## ========================================
## ğŸ“‹ åŸºæœ¬æƒ…å ±ã‚»ã‚¯ã‚·ãƒ§ãƒ³ (invoices ãƒ†ãƒ¼ãƒ–ãƒ«)
## ========================================

| ç”»é¢ã®é …ç›®å | DBåˆ—å | ç¾çŠ¶ |
|-------------|--------|------|
| è«‹æ±‚æ›¸No | invoice_id, invoice_number | OK |
| è«‹æ±‚ãƒ‡ãƒ¼ã‚¿å¹´æœˆ | billing_month | OK ("2025-01"å½¢å¼) |
| è«‹æ±‚æ—¥ï¼ˆç™ºè¡Œæ—¥ï¼‰ | billing_date | OK |
| (è‡ªå‹•è¨­å®š) | issue_date | OK (ä¿å­˜æ™‚ã®æ—¥ä»˜) |
| é¡§å®¢ã‚«ãƒ†ã‚´ãƒª | customer_category | OK |
| é¡§å®¢å | customer_name | OK |
| ä»¶å | subject, subject_name | OK |
| ç™»éŒ²ç•ªå·ï¼ˆä»»æ„ï¼‰ | registration_number | OK |
| ç™ºæ³¨ç•ªå·ï¼ˆä»»æ„ï¼‰ | order_number | OK |
| ã‚ªãƒ¼ãƒ€ãƒ¼ç•ªå·ï¼ˆä»»æ„ï¼‰ | purchase_order_number | OK |
| (å‚™è€ƒæ¬„ãŒã‚ã‚Œã°) | remarks | OK |
| (è¨ˆç®—å€¤) | subtotal | OK |
| (è¨ˆç®—å€¤) | tax | OK |
| (è¨ˆç®—å€¤) | total_amount | OK |

---

## ========================================
## ğŸ› ï¸ ä½œæ¥­é …ç›®å…¥åŠ›ã‚»ã‚¯ã‚·ãƒ§ãƒ³ (invoice_line_items ãƒ†ãƒ¼ãƒ–ãƒ«)
## ========================================

### ã€å€‹åˆ¥ä½œæ¥­ã‚¿ãƒ–ã€‘ã®å…¥åŠ›é …ç›®

| ç”»é¢ã®é …ç›®å | DBåˆ—å | ç¾çŠ¶ | å•é¡Œ |
|-------------|--------|------|------|
| å¯¾è±¡ | target | work_nameä¿å­˜ä¸­ | ??? |
| å‹•ä½œ | action1, action2, action3 | null | è¦ä¿®æ­£ |
| ä½ç½® | position1~position5 | null | è¦ä¿®æ­£ |
| ãã®ä»– | ??? | ??? | ã©ã“ã«ä¿å­˜? |
| å˜ä¾¡ | unit_price | OK | |
| æ•°é‡ | quantity | OK | |
| (è¨ˆç®—å€¤) | amount | OK | |

### ã€ã‚»ãƒƒãƒˆä½œæ¥­ã‚¿ãƒ–ã€‘ã®å…¥åŠ›é …ç›®

| ç”»é¢ã®é …ç›®å | DBåˆ—å | ç¾çŠ¶ | å•é¡Œ |
|-------------|--------|------|------|
| ã‚»ãƒƒãƒˆå | ??? | ??? | ã©ã“ã«ä¿å­˜? |
| ã‚»ãƒƒãƒˆä¾¡æ ¼ | unit_price | OK? | |
| ã‚»ãƒƒãƒˆæ•°é‡ | quantity | OK? | |
| ã‚»ãƒƒãƒˆæ˜ç´° | ??? | ??? | ã©ã“ã«ä¿å­˜? |

---

## ========================================
## ç¾åœ¨ã®ä¿å­˜ã‚³ãƒ¼ãƒ‰ (å•é¡Œã‚ã‚Š)
## ========================================

```typescript
const lineItems = workItems.map((item, index) => ({
  invoice_id: invoiceNumber,
  line_no: index + 1,
  task_type: item.type === 'set' ? 'S' : 'T',
  target: item.work_name,     // â† ã€Œå¯¾è±¡ã€ã§ã¯ãªãçµ„ã¿ç«‹ã¦ãƒ©ãƒ™ãƒ«ã‚’ä¿å­˜
  action: null,               // â† æ—§åˆ—å (ä»Šã¯action1)
  position: null,             // â† æ—§åˆ—å (ä»Šã¯position1)
  raw_label: ...,
  unit_price: item.unit_price,
  quantity: item.quantity,
  amount: item.unit_price * item.quantity,
  performed_at: billingDate
}))
```

---

## ========================================
## ç¢ºèªã—ãŸã„ã“ã¨
## ========================================

1. ã€Œå¯¾è±¡ã€â†’ targetåˆ—: å…¥åŠ›ã—ãŸå¯¾è±¡ã‚’ãã®ã¾ã¾ä¿å­˜?
2. ã€Œå‹•ä½œã€â†’ action1~3åˆ—: é¸æŠã—ãŸå‹•ä½œã‚’é †ç•ªã«ä¿å­˜?
3. ã€Œä½ç½®ã€â†’ position1~5åˆ—: é¸æŠã—ãŸä½ç½®ã‚’é †ç•ªã«ä¿å­˜?
4. ã€Œãã®ä»–ã€â†’ ã©ã®åˆ—ã«ä¿å­˜?
5. raw_labelåˆ—: ä½•ã‚’ä¿å­˜? çµ„ã¿ç«‹ã¦ãŸãƒ©ãƒ™ãƒ«å…¨ä½“?
6. sub_noåˆ—: ã„ã¤ä½¿ã†?

---

## ========================================
## DBåˆ—ä¸€è¦§ (invoice_line_items)
## ========================================

- invoice_id
- line_no
- sub_no (NEW)
- task_type ('T'=å€‹åˆ¥, 'S'=ã‚»ãƒƒãƒˆ)
- target
- action1 (NEW)
- action2 (NEW)
- action3 (NEW)
- position1 (NEW)
- position2 (NEW)
- position3 (NEW)
- position4 (NEW)
- position5 (NEW)
- raw_label
- unit_price
- quantity
- amount
- performed_at
